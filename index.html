<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Tes API Vercel</title>
    <style>
        body { font-family: system-ui, sans-serif; background-color: #f0f2f5; margin: 0; padding: 20px; }
        .container { max-width: 1200px; margin: 0 auto; }
        header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px; }
        #category-filters { margin-bottom: 20px; }
        #category-filters button, .lang-switcher button { padding: 8px 16px; border: 1px solid #ccc; background-color: #fff; cursor: pointer; margin-right: 5px; border-radius: 16px; }
        #category-filters button:hover, .lang-switcher button:hover { background-color: #e9e9e9; }
        #category-filters button.active { background-color: #007bff; color: white; border-color: #007bff; }
        #product-container { display: grid; grid-template-columns: repeat(auto-fill, minmax(280px, 1fr)); gap: 20px; }
        .product-card { background-color: #fff; border: 1px solid #ddd; border-radius: 8px; overflow: hidden; box-shadow: 0 4px 6px rgba(0,0,0,0.05); display: flex; flex-direction: column; }
        .product-card img { width: 100%; height: 220px; object-fit: cover; background-color: #eee; }
        .product-card-body { padding: 15px; display: flex; flex-direction: column; flex-grow: 1; }
        .product-card-body h3 { font-size: 16px; margin: 0 0 10px 0; }
        .product-card-body .description { font-size: 14px; color: #666; margin: 0 0 15px 0; flex-grow: 1; line-height: 1.5; }
        .product-card-footer { display: flex; justify-content: space-between; align-items: center; padding: 0 15px 15px 15px; }
        .product-card-footer .price { font-size: 18px; font-weight: bold; color: #28a745; }
        .product-card-footer .buy-btn { padding: 8px 16px; background-color: #007bff; color: white; border: none; border-radius: 5px; cursor: pointer; }
    </style>
</head>
<body>

    <div class="container">
        <header>
            <h1 data-translate-key="page-title">Toko Keren</h1>
            <div class="lang-switcher">
                <button id="btn-id">ID</button>
                <button id="btn-en">EN</button>
            </div>
        </header>

        <div id="category-filters">
            </div>
    
        <div id="product-container">
            <p data-translate-key="loading-text">Memuat produk...</p>
        </div>
    </div>

    <script>
        // --- KONFIGURASI & VARIABEL GLOBAL ---
        const API_URL = 'https://my-api-theta-three.vercel.app/pangeran/api'; // URL API BARU
        const productContainer = document.getElementById('product-container');
        const categoryFiltersContainer = document.getElementById('category-filters');
        
        let allProducts = [];
        let currentLang = 'id';

        const translations = {
            id: { 'page-title': 'Toko Keren', 'loading-text': 'Memuat produk...', 'all-categories': 'Semua', 'buy-button': 'Beli' },
            en: { 'page-title': 'Cool Store', 'loading-text': 'Loading products...', 'all-categories': 'All', 'buy-button': 'Buy' }
        };

        // --- FUNGSI-FUNGSI ---

        function renderProducts(productsToRender) {
            productContainer.innerHTML = '';
            productsToRender.forEach(product => {
                const card = document.createElement('div');
                card.className = 'product-card';
                
                // Menggunakan field dari API baru: name, description, images
                card.innerHTML = `
                    <img src="${product.images[0]}" alt="${product.name}">
                    <div class="product-card-body">
                        <h3>${product.name}</h3>
                        <p class="description">${product.description}</p>
                    </div>
                    <div class="product-card-footer">
                        <span class="price">Rp ${parseInt(product.price).toLocaleString('id-ID')}</span>
                        <button class="buy-btn" data-product-id="${product.id}">
                            <span data-translate-key="buy-button">Beli</span>
                        </button>
                    </div>
                `;
                productContainer.appendChild(card);
            });
            changeLanguage(currentLang);
        }

        function changeLanguage(lang) {
            currentLang = lang;
            document.querySelectorAll('[data-translate-key]').forEach(el => {
                const key = el.dataset.translateKey;
                if(translations[lang][key]) {
                    el.textContent = translations[lang][key];
                }
            });
        }

        function handleBuy(productId) {
            const product = allProducts.find(p => p.id == productId);
            alert(`Anda menambahkan "${product.name}" ke keranjang!`);
            // Karena tidak ada data stok, kita hanya menampilkan notifikasi
        }

        async function init() {
            try {
                const response = await fetch(API_URL);
                allProducts = await response.json();

                // Membuat daftar kategori unik dari data produk
                const categories = [...new Set(allProducts.map(p => p.category))];
                
                categoryFiltersContainer.innerHTML = `<button class="active" data-category="Semua">${translations[currentLang]['all-categories']}</button>`;
                categories.forEach(cat => {
                    categoryFiltersContainer.innerHTML += `<button data-category="${cat}">${cat}</button>`;
                });
                
                renderProducts(allProducts);

            } catch(error) { 
                console.error('Gagal fetch produk:', error);
                productContainer.innerHTML = '<p>Gagal memuat produk. Coba periksa koneksi atau URL API.</p>';
            }

            // --- EVENT LISTENERS ---
            document.getElementById('btn-id').addEventListener('click', () => changeLanguage('id'));
            document.getElementById('btn-en').addEventListener('click', () => changeLanguage('en'));

            categoryFiltersContainer.addEventListener('click', e => {
                if (e.target.tagName === 'BUTTON') {
                    document.querySelectorAll('#category-filters button').forEach(btn => btn.classList.remove('active'));
                    e.target.classList.add('active');

                    const categoryName = e.target.dataset.category;
                    if (categoryName === 'Semua') {
                        renderProducts(allProducts);
                    } else {
                        const filteredProducts = allProducts.filter(p => p.category === categoryName);
                        renderProducts(filteredProducts);
                    }
                }
            });

            productContainer.addEventListener('click', e => {
                if (e.target.closest('.buy-btn')) {
                    const productId = e.target.closest('.buy-btn').dataset.productId;
                    handleBuy(productId);
                }
            });
        }

        // --- MULAI APLIKASI ---
        init();
    </script>
</body>
</html>