<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Tes Proyek (Logika Sederhana)</title>
    <style>
        body { font-family: system-ui, sans-serif; background-color: #f0f2f5; margin: 0; padding: 20px; }
        .container { max-width: 1200px; margin: 0 auto; }
        header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px; }
        #category-filters { margin-bottom: 20px; }
        #category-filters button, .lang-switcher button { padding: 8px 16px; border: 1px solid #ccc; background-color: #fff; cursor: pointer; margin-right: 5px; border-radius: 16px; }
        #category-filters button:hover, .lang-switcher button:hover { background-color: #e9e9e9; }
        #category-filters button.active { background-color: #007bff; color: white; border-color: #007bff; }
        #product-container { display: grid; grid-template-columns: repeat(auto-fill, minmax(280px, 1fr)); gap: 20px; }
        .product-card { background-color: #fff; border: 1px solid #ddd; border-radius: 8px; overflow: hidden; box-shadow: 0 4px 6px rgba(0,0,0,0.05); display: flex; flex-direction: column; }
        .product-card img { width: 100%; height: 220px; object-fit: cover; background-color: #eee; }
        .product-card-body { padding: 15px; display: flex; flex-direction: column; flex-grow: 1; }
        .product-card-body h3 { font-size: 16px; margin: 0 0 10px 0; }
        .product-card-body .description { font-size: 14px; color: #666; margin: 0 0 15px 0; flex-grow: 1; line-height: 1.5; }
        .product-card-body .stock { font-size: 12px; color: #888; margin-bottom: 10px; }
        .product-card-footer { display: flex; justify-content: space-between; align-items: center; padding: 0 15px 15px 15px; }
        .product-card-footer .price { font-size: 18px; font-weight: bold; color: #28a745; }
        .product-card-footer .buy-btn { padding: 8px 16px; background-color: #007bff; color: white; border: none; border-radius: 5px; cursor: pointer; }
        .product-card-footer .buy-btn:disabled { background-color: #ccc; cursor: not-allowed; }
    </style>
</head>
<body>

    <div class="container">
        <header>
            <h1 data-translate-key="page-title">Toko Keren</h1>
            <div class="lang-switcher">
                <button id="btn-id">ID</button>
                <button id="btn-en">EN</button>
            </div>
        </header>

        <div id="category-filters">
            <button class="active" data-category="Semua">Semua Kategori</button>
            <button data-category="Pakaian">Pakaian</button>
            <button data-category="Elektronik">Elektronik</button>
            <button data-category="Buku">Buku</button>
        </div>
    
        <div id="product-container">
            <p data-translate-key="loading-text">Memuat produk...</p>
        </div>
    </div>

    <script>
        const API_BASE_URL = 'https://6884ac56745306380a39033c.mockapi.io/api/v1/products';
        const productContainer = document.getElementById('product-container');
        
        let allProducts = [];
        let currentLang = 'id';

        const translations = {
            id: { 'page-title': 'Toko Keren', 'loading-text': 'Memuat produk...', 'buy-button': 'Beli', 'stock-label': 'Stok' },
            en: { 'page-title': 'Cool Store', 'loading-text': 'Loading products...', 'buy-button': 'Buy', 'stock-label': 'Stock' }
        };

        function renderProducts(productsToRender) {
            productContainer.innerHTML = '';
            productsToRender.forEach(product => {
                const card = document.createElement('div');
                card.className = 'product-card';
                card.innerHTML = `
                    <img src="${product.images[0]}" alt="${product['title' + currentLang]}">
                    <div class="product-card-body">
                        <h3>${product['title' + currentLang]}</h3>
                        <p class="description">${product['description' + currentLang]}</p>
                        <p class="stock"><span data-translate-key="stock-label">Stok</span>: ${product.stock}</p>
                    </div>
                    <div class="product-card-footer">
                        <span class="price">Rp ${parseInt(product.price).toLocaleString('id-ID')}</span>
                        <button class="buy-btn" data-product-id="${product.id}" ${product.stock === 0 ? 'disabled' : ''}>
                            <span data-translate-key="buy-button">Beli</span>
                        </button>
                    </div>
                `;
                productContainer.appendChild(card);
            });
            changeLanguageUIOnly(currentLang);
        }

        function changeLanguageUIOnly(lang) {
            document.querySelectorAll('[data-translate-key]').forEach(el => {
                const key = el.dataset.translateKey;
                if(translations[lang][key]) el.textContent = translations[lang][key];
            });
        }
        
        function changeLanguage(lang) {
            currentLang = lang;
            changeLanguageUIOnly(lang);
            renderProducts(allProducts);
        }

        async function handleBuy(productId) {
            const product = allProducts.find(p => p.id === productId);
            if (!product || product.stock <= 0) { alert('Stok habis!'); return; }

            const updatedProduct = { ...product, stock: product.stock - 1 };
            
            try {
                const response = await fetch(`${API_BASE_URL}/products/${productId}`, {
                    method: 'PUT',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(updatedProduct)
                });
                if (!response.ok) throw new Error('Gagal update stok');

                allProducts = allProducts.map(p => p.id === productId ? updatedProduct : p);
                // Filter ulang berdasarkan kategori yang sedang aktif
                const activeCategory = document.querySelector('#category-filters button.active').dataset.category;
                const productsToShow = activeCategory === 'Semua' ? allProducts : allProducts.filter(p => p.category === activeCategory);
                renderProducts(productsToShow);
                alert('Produk berhasil dibeli!');

            } catch (error) {
                console.error('Error saat membeli produk:', error);
                alert('Gagal memproses pembelian.');
            }
        }

        async function init() {
            try {
                const responseProd = await fetch(`${API_BASE_URL}/products`);
                allProducts = await responseProd.json();
                renderProducts(allProducts);
            } catch(error) { 
                console.error('Gagal fetch produk:', error);
                productContainer.innerHTML = '<p>Gagal memuat produk.</p>';
            }

            document.getElementById('btn-id').addEventListener('click', () => changeLanguage('id'));
            document.getElementById('btn-en').addEventListener('click', () => changeLanguage('en'));

            document.getElementById('category-filters').addEventListener('click', e => {
                if (e.target.tagName === 'BUTTON') {
                    document.querySelectorAll('#category-filters button').forEach(btn => btn.classList.remove('active'));
                    e.target.classList.add('active');

                    const categoryName = e.target.dataset.category;
                    if (categoryName === 'Semua') {
                        renderProducts(allProducts);
                    } else {
                        // Logika filter disederhanakan
                        const filteredProducts = allProducts.filter(p => p.category === categoryName);
                        renderProducts(filteredProducts);
                    }
                }
            });

            productContainer.addEventListener('click', e => {
                if (e.target.closest('.buy-btn')) {
                    const productId = e.target.closest('.buy-btn').dataset.productId;
                    handleBuy(productId);
                }
            });
        }

        init();
    </script>
</body>
</html>